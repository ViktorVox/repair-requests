# РемонтСервис (Вайб-кодер тестовое)

Современный веб-сервис для приёма и обработки заявок в ремонтную службу. Позволяет клиентам оставлять заявки, диспетчерам — модерировать их, а мастерам — брать в работу.

## Стек технологий
- **Backend:** Laravel 11, PostgreSQL
- **Frontend:** Vue 3 (Composition API), Inertia.js, Tailwind CSS
- **Инфраструктура:** Laravel Sail (Docker)

## Развертывание проекта

Так как проект использует Laravel Sail, для локального запуска нужен только установленный Docker (и WSL, если вы на Windows).

1. Клонируйте репозиторий и перейдите в папку проекта.
2. Скопируйте `.env.example` в `.env`:
   ```bash
   cp .env.example .env
   ```
3. Поднимите контейнеры:
   ```bash
   ./vendor/bin/sail up -d
   ```
4. Сгенерируйте ключ приложения, накатите миграции и сиды:
   ```bash
   ./vendor/bin/sail artisan key:generate
   ./vendor/bin/sail artisan migrate:fresh --seed
   ```
5. Установите NPM-зависимости и соберите фронтенд:
   ```bash
   ./vendor/bin/sail npm install
   ./vendor/bin/sail npm run build
   ```
   (Для разработки в реальном времени используйте ./vendor/bin/sail npm run dev)

Проект будет доступен по адресу: http://localhost

## Тестовые доступы
Сиды автоматически создают пользователей со следующими ролями. Пароль для всех: `password`
* **Диспетчер:** dispatcher@test.com (Видит все заявки, может отменять их)
* **Мастер 1:** master1@test.com (Видит новые заявки, может брать в работу и менять статус)
* **Мастер 2:** master2@test.com

## Тестирование "Гонки" (Race Condition)
В проекте реализована пессимистичная блокировка БД (`lockForUpdate`), чтобы исключить ситуацию, когда два мастера одновременно берут одну и ту же заявку в работу.

Для проверки запустите bash-скрипт из корня проекта:
```bash
chmod +x race_test.sh
./race_test.sh
```

Скрипт программно авторизует двух мастеров и отправляет параллельный POST-запрос на взятие заявки #1. Бэкенд корректно обработает блокировку: один мастер получит заявку, второй — сообщение об ошибке (Conflict).

## Автотесты
В проекте реализованы Feature-тесты для проверки ключевой бизнес-логики (создание заявки и взятие её в работу). 
Для запуска тестов выполните команду:
```bash
./vendor/bin/sail artisan test