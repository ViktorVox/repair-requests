[ 22:33 - 27.02.2026 ]

Привет! Выступай в роли Tech Lead и Senior Laravel Разработчика. Мы в паре делаем тестовое задание на позицию "Вайб-кодер" (быстрое прототипирование, фокус на результат, чистая архитектура).
Задача: веб-сервис для приёма заявок в ремонтную службу. 

**Наш стек:** Laravel 11, Vue 3 (через Breeze/Inertia), PostgreSQL. 
**Окружение:** Я работаю в WSL. Инфраструктура полностью поднята через стандартный Laravel Sail (контейнеры работают). Breeze с Vue уже установлен.

**ПРАВИЛА НАШЕГО ВЗАИМОДЕЙСТВИЯ (СТРОГО):**
1. **Терминал:** Все команды давай строго через Sail: `./vendor/bin/sail artisan ...` или `./vendor/bin/sail npm ...`.
2. **Git:** В конце каждого ответа пиши команды для коммита. Используй гибридный формат Conventional Commits: английский тег + описание на русском. Пример: `git commit -m "feat: добавил роли пользователей"`.
3. **Защита от ошибок ИИ:** Внимательно проверяй свой код перед отправкой. Не используй неимпортированные классы или трейты (например, если используешь `WithoutModelEvents` в Seeder — обязательно добавь `use`).
4. **Формат ответа:** [План] -> [Код файлов] -> [Команды терминала] -> [Git коммит].

**ЗАДАЧА НА ШАГ 1 (База данных и Сиды):**
1. Создай миграцию, которая добавит поле `role` (enum: 'dispatcher', 'master') в стандартную таблицу `users`. По умолчанию 'dispatcher'.
2. Создай Модель и Миграцию для заявок. Назови модель `ServiceRequest`. 
   Поля таблицы: 
   - `client_name` (string)
   - `phone` (string)
   - `address` (string)
   - `problem_text` (text)
   - `status` (enum: 'new', 'assigned', 'in_progress', 'done', 'canceled'. По умолчанию 'new').
   - `assigned_to` (foreignId, ссылается на users, nullable).
3. Напиши `DatabaseSeeder`, который создаст:
   - 1 диспетчера (email: dispatcher@test.com)
   - 2 мастеров (email: master1@test.com, master2@test.com)
   - 5 тестовых заявок в разных статусах, привязанных к мастерам и без них. У всех юзеров пароль 'password'.

Выдай решение строго по согласованному формату.



[ 22:39 - 27.02.2026 ]

Отличная работа! База данных и сиды успешно накатились. Переходим к бизнес-логике.

**ЗАДАЧА НА ШАГ 2 (Контроллеры, Маршруты и проблема "Гонки"):**
Нам нужно создать контроллер для обработки заявок и настроить маршрутизацию. Так как у нас Breeze с Vue, ответы должны отдаваться через Inertia.js.

**ПРАВИЛА ОСТАЮТСЯ ТЕМИ ЖЕ:**
1. Команды строго через `./vendor/bin/sail ...`.
2. Формат: [План] -> [Код] -> [Команды] -> [Коммит] (гибридный формат).

**ЧТО НУЖНО СДЕЛАТЬ:**
1. Напиши логику в `routes/web.php`:
   - Публичные роуты: GET `/` (страница с формой) и POST `/requests` (сохранение заявки).
   - Защищенные роуты (auth): GET `/dashboard` (список заявок), POST `/requests/{serviceRequest}/take` (взять в работу), PATCH `/requests/{serviceRequest}/status` (изменить статус).
2. Напиши команды для создания и сам код `ServiceRequestController`:
   - `create`: возвращает `Inertia::render('Welcome')`.
   - `store`: валидация (client_name, phone, address, problem_text) и создание заявки. Возвращает редирект с флеш-сообщением.
   - `index`: Возвращает `Inertia::render('Dashboard', ['requests' => ...])`. Логика выборки: Диспетчер получает все заявки, Мастер — только заявки со статусом 'new' и те, которые назначены лично на него.
   - `takeToWork`: **КРИТИЧЕСКИ ВАЖНО!** Реши проблему "гонки" (Race Condition) при параллельных запросах. Используй `DB::transaction()` и пессимистичную блокировку `lockForUpdate()`. Если статус заявки уже не 'new', отменяем транзакцию и возвращаем HTTP 409 Conflict (или Inertia redirect с ошибкой).
   - `updateStatus`: Изменение статуса (например, диспетчер отменяет, или мастер переводит в 'done').
3. Код самих Vue-страниц пока не пиши, просто правильно вызывай `Inertia::render` в контроллере.

Жду решение!



[ 22:42 - 27.02.2026 ]

Супер! Бэкенд с защитой от "гонки" готов. Переходим к фронтенду на Vue 3 + Tailwind CSS (Inertia).

**ЗАДАЧА НА ШАГ 3 (Фронтенд: Vue Компоненты):**
Нам нужно сверстать две страницы. Используй `<script setup>` и Composition API. Для стилизации используй Tailwind CSS.

**ПРАВИЛА ОСТАЮТСЯ:**
Формат: [План] -> [Код] -> [Команды терминала] -> [Git коммит].

**ЧТО НУЖНО СДЕЛАТЬ:**

**1. `resources/js/Pages/Welcome.vue` (Публичная страница):**
Это форма создания заявки. 
- Поля: Имя клиента, Телефон, Адрес, Описание проблемы.
- Используй `useForm` из `@inertiajs/vue3` для отправки POST запроса на `/requests`.
- Добавь вывод флеш-сообщений об успешной отправке (мы передаем их в контроллере).
- Оставь в шапке ссылку на вход (`/login`) для сотрудников.

**2. `resources/js/Pages/Dashboard.vue` (Панель управления):**
Этот компонент должен отображать разный интерфейс в зависимости от роли текущего пользователя (`$page.props.auth.user.role`).
- В `props` мы получаем массив `requests`.
- **Для Диспетчера:** - Вывод всех заявок в виде таблицы/карточек.
  - Кнопки для изменения статуса (например, возможность отменить заявку `canceled`).
- **Для Мастера:**
  - Вывод заявок (новые и свои).
  - Если статус `new` -> кнопка "Взять в работу" (POST на `/requests/{id}/take`).
  - Если статус `assigned` (и заявка его) -> кнопка "Начать работу" (PATCH на `/requests/{id}/status` со статусом `in_progress`).
  - Если статус `in_progress` -> кнопка "Завершить" (PATCH со статусом `done`).
- Обязательно выводи ошибки (например, если мастер нажал "Взять в работу", но произошла ошибка гонки, выведи `form.errors.conflict` из контроллера).

Напиши полный код для этих двух файлов.